# Data Fusion Contest 2026 — Задача 3 «Герои»

Публичное решение задачи маршрутизации героев (VRPTW-подобная постановка). Единый пайплайн в одном скрипте: перебор конфигов, VRP по дням, постобработка; результат — файл для отправки на платформу.

**Метрика:** VRPTW Score = сумма наград за посещённые объекты − 2500 × max(hero_id).

---

## Зависимости

- Python 3.10+
- Пакеты: `pandas`, `numpy`, `ortools` (в `requirements.txt`)

```bash
pip install -r requirements.txt
```

В каталоге со скриптом должны лежать данные соревнования: `data_heroes.csv`, `data_objects.csv`, `dist_start.csv`, `dist_objects.csv`.

---

## Запуск

**Полный перебор (7 конфигов, ~25–40 мин):**

```bash
python task_3.py
```

**Быстрый режим (3 конфига, ~10–15 мин):**

```bash
python task_3.py --fast
```

Результат записывается в **`submission.csv`** (колонки `hero_id`, `object_id`) — этот файл отправляется на платформу.

---

## Алгоритм

1. **Декомпозиция по дням.** Временные окна (день появления объекта) задаются разбиением по дням, а не одним большим VRP. День 1: все герои стартуют из депо (замок); решаем CVRP с disjunctions (не все объекты обязательны, за непосещённый — штраф). Ограничение по очкам хода (move_points + 100 за «последний шаг»). Дни 2–7: у каждого героя своё «депо» — конечная позиция предыдущего дня; своя матрица расстояний и тот же решатель (OR-Tools, Parallel Cheapest Insertion + Guided Local Search).

2. **Перебор конфигов.** Задаются наборы `(num_heroes, time_limit_day1, time_limit_dayN)` — 7 в полном режиме, 3 в быстром. Число героев 18–21, лимиты 120/180 с для дня 1 и 10/15 с для дней 2–7. Решатель недетерминирован, поэтому перебор даёт разные решения; по локальной симуляции выбирается конфиг с максимальным VRPTW Score.

3. **Постобработка (merge).** После каждого прогона пайплайна: жадное слияние маршрута последнего героя (max hero_id) в предпоследнего. Сравниваются скоры до и после; если скор вырос — решение заменяется, и шаг повторяется, пока скор не перестанет расти. Так часто удаётся уменьшить max_hero_id без потери визитов.

Итог: загрузка данных → для каждого конфига `run_pipeline` (день 1 → дни 2–7) → merge до стабильности → симуляция и выбор лучшего → запись `submission.csv`.

---

## Пример вывода

Полный прогон (7 конфигов):

```
Configs: 7
  [1/7] H=20 120s/10s ... score=294000 reward=344000 max_h=20 visits=688 *
  [2/7] H=20 180s/15s ... score=294000 reward=344000 max_h=20 visits=688
  [3/7] H=19 120s/10s ... score=294500 reward=342000 max_h=19 visits=684 *
  [4/7] H=19 180s/15s ... score=234000 reward=281500 max_h=19 visits=563
  [5/7] H=21 120s/10s ... score=293500 reward=346000 max_h=21 visits=692
  [6/7] H=21 180s/15s ... score=293500 reward=346000 max_h=21 visits=692
  [7/7] H=18 180s/15s ... score=238500 reward=283500 max_h=18 visits=567

Score: 294500
Reward: 342000  Max hero: 19  Visits: 684
```

Звёздочка `*` отмечает конфиг, давший новый лучший скор на момент вывода. Итоговый результат соответствует лучшему из прогонов (здесь 294500 при 19 героях и 684 визитах).

---

## Файлы

- **`task_3.py`** —  скрипт: загрузка данных, VRP по дням (OR-Tools), merge, перебор конфигов, вывод `submission.csv`.
- **`requirements.txt`** — зависимости для `pip install -r requirements.txt`.
